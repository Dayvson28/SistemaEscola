@page "/"
@using SistemaEscolar.Services
@using SistemaEscolar.Models
@inject TurmaService TurmaService

<PageTitle>Sistema Escolar - Dashboard</PageTitle>

<div class="container mt-5">
    @* <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Dashboard do Sistema Escolar</h1>
    </div> *@

    <div class="row">
        <!-- Card de Turmas por Série -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Turmas por Série</h5>
                </div>
                <div class="card-body">
                    <table class="table table-striped" >
                        <thead>
                            <tr>
                                <th>Série</th>
                                <th>Quantidade de Turmas</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if(TurmasPorSerie == null || !TurmasPorSerie.Any())
                            {
                                <tr>
                                    <td colspan="2" class="text-center text-muted">
                                        Nenhum dado encontrado!
                                    </td>
                                </tr>
                            }
                            @foreach (var serie in TurmasPorSerie)
                            {
                                <tr>
                                    <td>@serie.Key</td>
                                    <td>@serie.Value</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Card de Estudantes por Série -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Estudantes por Série</h5>
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Série</th>
                                <th>Quantidade de Estudantes</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if(EstudantesPorSerie == null || !EstudantesPorSerie.Any())
                            {
                                <tr>
                                    <td colspan="2" class="text-center text-muted">
                                        Nenhum dado encontrado!
                                    </td>
                                </tr>
                            }
                            @foreach (var serie in EstudantesPorSerie)
                            {
                                <tr>
                                    <td>@serie.Key</td>
                                    <td>@serie.Value</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
        </div>

@code {
    // Armazena a quantidade de turmas por série
    private Dictionary<string, int> TurmasPorSerie { get; set; } = new(); 
    // Armazena a quantidade de estudantes por série
    private Dictionary<string, int> EstudantesPorSerie { get; set; } = new(); 

    protected override void OnInitialized()
    {
        // Obter todas as turmas
        var turmas = TurmaService.ObterTodasTurmas();
        
        // Calcular quantidade de turmas por série
        TurmasPorSerie = turmas
            .GroupBy(t => t.Serie)
            .ToDictionary(g => g.Key, g => g.Count());
        
        // Obter quantidade de estudantes por série
        EstudantesPorSerie = TurmaService.ObterQuantidadeEstudantesPorSerie();
    }
}
